package stepDefinitions;

import org.openqa.selenium.WebDriver;
import org.junit.Assert;
import io.cucumber.java.en.*;
import pageObjects.UsersPage;
import utilities.DriverManager;

public class UsersSteps {
    WebDriver driver = DriverManager.getDriver();
    UsersPage usersPage = new UsersPage(driver);

    @Given("I am on the Users module")
    public void i_am_on_the_users_module() {
        usersPage.clickUsersMenu();
    }

    @When("I click the Add User button")
    public void i_click_the_add_user_button() {
        usersPage.clickCreateButton();
    }

    @When("I fill in user details with name {string}, email {string}, phone {string}, role {string}, status {string}")
    public void i_fill_in_user_details(String name, String email, String phone, String role, String status) {
        usersPage.enterName(name);
        usersPage.enterEmail(email);
        usersPage.enterPhone(phone);
        usersPage.selectRole(role);
        usersPage.selectStatus(status);
    }

    @When("I submit the user creation form")
    public void i_submit_the_user_creation_form() {
        usersPage.clickSubmit();
    }

    @Then("I should see the user added successfully")
    public void i_should_see_the_user_added_successfully() {
        Assert.assertTrue(usersPage.isUserCreated());
    }

    @When("I search for the user with keyword {string}")
    public void i_search_for_the_user(String keyword) {
        usersPage.searchUser(keyword);
    }

    @Then("I should see the user {string} in the results table")
    public void i_should_see_user_in_table(String expectedName) {
        Assert.assertTrue(usersPage.isUserDisplayedInTable(expectedName));
    }

    @When("I click Edit on the first user")
    public void i_click_edit_on_the_first_user() {
        usersPage.clickEditUser();
    }

    @When("I update the user name to {string}")
    public void i_update_user_name(String newName) {
        usersPage.enterName(newName); // assuming same input field is used
    }

    @When("I delete the first user")
    public void i_delete_the_first_user() {
        usersPage.clickDeleteUser();
        usersPage.confirmDelete();
    }

    @Then("I should not see the user {string} in the results table")
    public void i_should_not_see_user(String deletedName) {
        Assert.assertFalse(usersPage.isUserDisplayedInTable(deletedName));
    }

    @When("I select status as {string} from dropdown")
    public void i_select_status_filter(String status) {
        usersPage.selectStatus(status);
    }

    @When("I click on Apply Filter")
    public void i_click_on_apply_filter() {
        usersPage.applyFilter();
    }

    @Then("I should see filtered results with status {string}")
    public void i_should_see_filtered_results(String expectedStatus) {
        // This assumes rows contain the status text
        Assert.assertTrue(usersPage.isUserDisplayedInTable(expectedStatus));
    }
}
